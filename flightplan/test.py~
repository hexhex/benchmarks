import re
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
from selenium.webdriver.common.by import By
from selenium import webdriver
from datetime import datetime

def getPrice(query):

	q = ""
	for stop in query:
		q = q + "/" + stop[0] + "-" + stop[1] + "/" + stop[2].strftime('%Y-%m-%d')

	# Start the WebDriver and load the page
	wd = webdriver.Firefox()
	wd.get("http://www.kayak.de/flights" + q)
	
	# Wait for the dynamically loaded elements to show up
	
	# And grab the page HTML source
	html_page = wd.page_source
	wd.quit()
	
	pattern = re.compile(u"bestPrice[^>]*>[0-9]+")
	minprice = -1
	for p in pattern.findall(html_page):
		price = int(p[p.index('>') + 1:])
		if minprice == -1 or price < minprice:
			minprice = price
	
	return minprice

print(getPrice( (
					("VIE", "LAX", datetime(2015, 7, 3)),
					("LAX", "HNL", datetime(2015, 7, 7)),
					("HNL", "SFO", datetime(2015, 7, 11)),
					("SFO", "LAS", datetime(2015, 7, 14)),
					("LAS", "MIA", datetime(2015, 7, 18)),
					("MIA", "VIE", datetime(2015, 7, 21)),
				) ))

print(getPrice( (
					("VIE", "MIA", datetime(2015, 7, 3)),
					("MIA", "VIE", datetime(2015, 7, 21)),
				) ))

print(getPrice( (
					("MIA", "LAX", datetime(2015, 7, 3)),
					("LAX", "HNL", datetime(2015, 7, 7)),
					("HNL", "SFO", datetime(2015, 7, 11)),
					("SFO", "LAS", datetime(2015, 7, 14)),
					("LAS", "MIA", datetime(2015, 7, 18)),
				) ))

